name: Week 2 - SAST Pipeline

on:
  push:
    branches:
      - week-2

jobs:
  sast:
    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v3

      - name: Install Bandit
        run: python -m pip install bandit

      - name: Generate Bandit Report
        run: python -m bandit -r week2-sast-sonarqube -f json -o bandit-report.json
        continue-on-error: true

      - name: Enforce Security Gate
        run: python -m bandit -r week2-sast-sonarqube -ll 
        continue-on-error: true
     
      - name: Notify Slack on Failure
        if: failure()
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data '{"text":"ðŸš¨ Week 2 SAST Failed! SQL Injection detected in pipeline."}' \
          ${{ secrets.SLACK_WEBHOOK_URL }}
